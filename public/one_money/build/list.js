function PromotionItem(t,e){var s=["avatar_urls","cover_urls","image_urls"],a=["start_at","end_at"];for(var n in t){var i=t[n];s.indexOf(n)>-1&&(i=JSON.parse(i)),a.indexOf(n)>-1&&(i=Date.parse(i)-e),this[n]=i}this.render(),this.countDownTime()}var one_money_id=window.one_money_id||1,beforeTime=(new Date).getTime(),params=getQueryParams();params.status&&$.ajax({url:"/api/promotions/one_money/"+window.one_money_id+"/signup",type:"PUT",dataType:"json",success:function(){},error:function(){}}),$.ajax({url:"/api/promotions/one_money/"+one_money_id+"/items?u="+beforeTime,success:function(t){var e=(new Date).getTime(),s=Math.ceil(t.td+(e-beforeTime)/2);t.items.map(function(t){new PromotionItem(t,s)})},error:function(t){console.log(t)}}),PromotionItem.prototype={getStatus:function(){var t=(new Date).getTime();return"timing"!=this.status?this.status:this.total_amount<1?"suspend":t<this.start_at?"wait":t>this.end_at?"end":"started"},changeStatus:function(t){$(".promotion-item[name="+this.id+"] .status-wrap").html(this.statusFlagTemplate(t))},countDownTime:function(){function t(){var n=(new Date).getTime();return n>s.end_at&&"end"!=e?(e="end",a.removeHandler(t),s.changeStatus("end")):n>s.start_at&&"started"!=e?(e="started",s.changeStatus("started")):void 0}var e=this.getStatus();if("end"!=e&&"suspend"!=e){var s=this,a=CountDownManager.getManager();a.addHandler(t)}},statusFlagTemplate:function(t){var t=t||this.getStatus(),e=this.completes||0,s=this.total_amount;switch(s-=e,t){case"wait":return'<span class="status wait">未开始</span>&emsp;库存:'+this.total_amount;case"end":return'<span class="status end">已结束</span>&emsp;库存:'+this.total_amount;case"suspend":return'<span class="status end">已售罄</span>&emsp;库存:'+this.total_amount;case"started":return'<span class="status">抢购中</span>&emsp;库存:'+this.total_amount}},template:function(){return'      <li class="promotion-item" name='+this.id+'>        <a class="item-wrap" href="detail.html?one_money_id='+this.one_money_id+"&id="+this.id+'">          <header>            <img class="one-money-logo" src="./images/one_money_log.jpg"/>            <img class="cover" src="'+this.cover_urls[0]+'">            <div class="limit">            </div>          </header>          <main>            <p class="title">'+this.title+'</p>            <div class="price-wrap">              <span class="now-price">￥'+this.price+'</span>              <span class="origin-price">原价<s>￥'+this.ori_price+'&nbsp;</s></span>            </div>            <div class="status-wrap">'+this.statusFlagTemplate()+"</div>          </main>        </a>      </li>"},render:function(t){var t=t||$(".promotions-list");t.append(this.template())}};