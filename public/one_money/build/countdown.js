(function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),s=this,e=function(){},o=function(){return s.apply(this instanceof e?this:t,n.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(e.prototype=this.prototype),o.prototype=new e,o}),this.CountDown=function(){function t(t,n,s,e,o,i){return this.element=t,this.inventory=n,this.startTime=s,this.endTime=e,this.status=o,this.statusChangedCallback=i,"end"===o?this._showFinishText():"suspend"===o?this._showSuspendText():void(+n>0&&this._addCountdownHandler())}return t.DATE_UNIT={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3},t.prototype.$=function(){return $(this.element)},t.prototype._applyClass=function(t){return this.$().parent().removeClass("not-started started finished").addClass(t)},t.prototype._addCountdownHandler=function(){var t=CountDownManager.getManager();t.addHandler(this._countdownHandler,this)},t.prototype._removeCountdownHander=function(){var t=CountDownManager.getManager();t.removeHandler(this._countdownHandler,this)},t.prototype._diff=function(t,n){return n-t},t.prototype.duration=function(n,s){var e,o,i,r,a,h;return o=this._diff(n,s),e=Math.floor(o/t.DATE_UNIT.DAY),h=o-e*t.DATE_UNIT.DAY,i=Math.floor(h/t.DATE_UNIT.HOUR),h-=i*t.DATE_UNIT.HOUR,r=Math.floor(h/t.DATE_UNIT.MINUTE),h-=r*t.DATE_UNIT.MINUTE,a=Math.floor(h/t.DATE_UNIT.SECOND),{days:e,hours:i,minutes:r,seconds:a,times:o}},t.prototype._countdownHandler=function(){var n,s,e,o,i,r,a;return r=(new Date).getTime(),s=this._diff(this.startTime,r),n=this._diff(r,this.endTime),i="started"===this.status?!0:s>0,o=("started"===this.status||"timing"===this.status)&&0>n,a=null,e=null,o?("end"!=this.status&&(this.status="end","function"==typeof this.statusChangedCallback&&this.statusChangedCallback(this.status),this._removeCountdownHander()),this._showFinishText()):i?("started"!=this.status&&(this.status="started","function"==typeof this.statusChangedCallback&&this.statusChangedCallback(this.status)),a="距活动结束还有<br />",e=this.duration(r,this.endTime),this._updateCountdownText(a,e)):(a="距活动开始还有<br />",e=this.duration(r,this.startTime),e.times>t.DATE_UNIT.DAY?this._showStartText():this._updateCountdownText(a,e))},t.prototype.getCurrentStatus=function(){switch(this.status){case"started":case"end":case"suspend":return this.status;default:var t=new Date,n=this._diff(this.startTime,t),s=this._diff(t,this.endTime),e=n>0,o=0>s;if(e)return"started";if(o)return"end"}},t.prototype._updateCountdownText=function(t,n){var s=this._formatShortTime(n);return this.$().html(t+s)},t.prototype._showStartText=function(){return this._hasShown?void 0:(this._hasShown=!0,this.$().html("活动开始时间: "+this._formatFullyTime(this.startTime)),this._applyClass("not-started"))},t.prototype._showFinishText=function(){return this.$().html("活动已结束"),this._applyClass("finished")},t.prototype._showSuspendText=function(){return this.$().html("已售罄"),this._applyClass("finished")},t.prototype._showInventoryText=function(){return this.$().html("库存剩余"+this.inventory+"件"),this._applyClass("started")},t.prototype._formatFullyTime=function(t){var n,s,e,o,i;return t=new Date(t),i=t.getFullYear(),o=this._formatValue(t.getMonth()+1),n=this._formatValue(t.getDate()),s=this._formatValue(t.getHours()),e=this._formatValue(t.getMinutes()),[[i,o,n].join("/"),[s,e].join(":")].join(" ")},t.prototype._formatShortTime=function(t){var n,s,e,o;n=this._format(t,"days"),s=this._format(t,"hours"),e=this._format(t,"minutes"),o=this._format(t,"seconds");var i='<span class="tow-dots">:</span>',r=[s,e,o].map(function(t){var n=t.toString().split("");return n.map(function(t){return'<span class="time-number">'+t+"</span>"}).join("")});return 0==n?r.join(i):[n,"天",r.join(i)].join("")},t.prototype._format=function(t,n){var s;return s=t[n],this._formatValue(s)},t.prototype._formatValue=function(t){return 10>t?"0"+t:t},t}()}).call(this);