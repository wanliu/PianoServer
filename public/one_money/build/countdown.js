(function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),o=this,e=function(){},i=function(){return o.apply(this instanceof e?this:t,n.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(e.prototype=this.prototype),i.prototype=new e,i}),this.CountDown=function(){function t(t,n,o,e,i){this.element=t,this.inventory=n,this.startTime=o,this.endTime=e,this.statusChangedCallback=i,+n>0&&this._addCountdownHandler()}return t.DATE_UNIT={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3},t.prototype.$=function(){return $(this.element)},t.prototype._applyClass=function(t){return this.$().parent().removeClass("not-started started finished").addClass(t)},t.prototype._addCountdownHandler=function(){var t=CountDownManager.getManager();t.addHandler(this._countdownHandler,this)},t.prototype._removeCountdownHander=function(){var t=CountDownManager.getManager();t.removeHandler(this._countdownHandler,this)},t.prototype._diff=function(t,n){return n-t},t.prototype.duration=function(n,o){var e,i,s,r,a,h;return i=this._diff(n,o),e=Math.floor(i/t.DATE_UNIT.DAY),h=i-e*t.DATE_UNIT.DAY,s=Math.floor(h/t.DATE_UNIT.HOUR),h-=s*t.DATE_UNIT.HOUR,r=Math.floor(h/t.DATE_UNIT.MINUTE),h-=r*t.DATE_UNIT.MINUTE,a=Math.floor(h/t.DATE_UNIT.SECOND),{days:e,hours:s,minutes:r,seconds:a,times:i}},t.prototype._countdownHandler=function(){var n,o,e,i,s,r,a;return r=new Date,o=this._diff(this.startTime,r),n=this._diff(r,this.endTime),s=o>0,i=0>n,a=null,e=null,i?("end"!=this.status&&(this.status="end","function"==typeof this.statusChangedCallback&&this.statusChangedCallback(this.status),this._removeCountdownHander()),this._showFinishText()):s?("started"!=this.status&&(this.status="started","function"==typeof this.statusChangedCallback&&this.statusChangedCallback(this.status)),a="距活动结束还有",e=this.duration(r,this.endTime),this._updateCountdownText(a,e)):(a="距活动开始还有",e=this.duration(r,this.startTime),e.times>t.DATE_UNIT.DAY?this._showStartText():this._updateCountdownText(a,e))},t.prototype._updateCountdownText=function(t,n){var o=this._formatShortTime(n);return this.$().text(t+o)},t.prototype._showStartText=function(){return this._hasShown?void 0:(this._hasShown=!0,this.$().text("活动开始时间: "+this._formatFullyTime(this.startTime)),this._applyClass("not-started"))},t.prototype._showFinishText=function(){return this.$().text("活动已结束"),this._applyClass("finished")},t.prototype._showInventoryText=function(){return this.$().text("库存剩余"+this.inventory+"件"),this._applyClass("started")},t.prototype._formatFullyTime=function(t){var n,o,e,i,s;return t=new Date(t),s=t.getFullYear(),i=this._formatValue(t.getMonth()+1),n=this._formatValue(t.getDate()),o=this._formatValue(t.getHours()),e=this._formatValue(t.getMinutes()),[[s,i,n].join("/"),[o,e].join(":")].join(" ")},t.prototype._formatShortTime=function(t){var n,o,e,i;return n=this._format(t,"days"),o=this._format(t,"hours"),e=this._format(t,"minutes"),i=this._format(t,"seconds"),0==n?[o,e,i].join(":"):[n,"天",[o,e,i].join(":")].join("")},t.prototype._format=function(t,n){var o;return o=t[n],this._formatValue(o)},t.prototype._formatValue=function(t){return 10>t?"0"+t:t},t}()}).call(this);