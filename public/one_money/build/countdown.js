(function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),o=this,s=function(){},e=function(){return o.apply(this instanceof s?this:t,n.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(s.prototype=this.prototype),e.prototype=new s,e}),this.CountDown=function(){function t(t,n,o,s,e,i){return this.element=t,this.inventory=n,this.startTime=o,this.endTime=s,this.status=e,this.statusChangedCallback=i,"end"===e?this._showFinishText():"suspend"===e?this._showSuspendText():void(+n>0&&this._addCountdownHandler())}return t.DATE_UNIT={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3},t.prototype.$=function(){return $(this.element)},t.prototype._applyClass=function(t){return this.$().parent().removeClass("not-started started finished").addClass(t)},t.prototype._addCountdownHandler=function(){var t=CountDownManager.getManager();t.addHandler(this._countdownHandler,this)},t.prototype._removeCountdownHander=function(){var t=CountDownManager.getManager();t.removeHandler(this._countdownHandler,this)},t.prototype._diff=function(t,n){return n-t},t.prototype.duration=function(n,o){var s,e,i,r,a,h;return e=this._diff(n,o),s=Math.floor(e/t.DATE_UNIT.DAY),h=e-s*t.DATE_UNIT.DAY,i=Math.floor(h/t.DATE_UNIT.HOUR),h-=i*t.DATE_UNIT.HOUR,r=Math.floor(h/t.DATE_UNIT.MINUTE),h-=r*t.DATE_UNIT.MINUTE,a=Math.floor(h/t.DATE_UNIT.SECOND),{days:s,hours:i,minutes:r,seconds:a,times:e}},t.prototype._countdownHandler=function(){var n,o,s,e,i,r,a;return r=new Date,o=this._diff(this.startTime,r),n=this._diff(r,this.endTime),i=o>0,e=0>n,a=null,s=null,e?("end"!=this.status&&(this.status="end","function"==typeof this.statusChangedCallback&&this.statusChangedCallback(this.status),this._removeCountdownHander()),this._showFinishText()):i?("started"!=this.status&&(this.status="started","function"==typeof this.statusChangedCallback&&this.statusChangedCallback(this.status)),a="距活动结束还有<br />",s=this.duration(r,this.endTime),this._updateCountdownText(a,s)):(a="距活动开始还有<br />",s=this.duration(r,this.startTime),s.times>t.DATE_UNIT.DAY?this._showStartText():this._updateCountdownText(a,s))},t.prototype._updateCountdownText=function(t,n){var o=this._formatShortTime(n);return this.$().html(t+o)},t.prototype._showStartText=function(){return this._hasShown?void 0:(this._hasShown=!0,this.$().html("活动开始时间: "+this._formatFullyTime(this.startTime)),this._applyClass("not-started"))},t.prototype._showFinishText=function(){return this.$().html("活动已结束"),this._applyClass("finished")},t.prototype._showSuspendText=function(){return this.$().html("已售罄"),this._applyClass("finished")},t.prototype._showInventoryText=function(){return this.$().html("库存剩余"+this.inventory+"件"),this._applyClass("started")},t.prototype._formatFullyTime=function(t){var n,o,s,e,i;return t=new Date(t),i=t.getFullYear(),e=this._formatValue(t.getMonth()+1),n=this._formatValue(t.getDate()),o=this._formatValue(t.getHours()),s=this._formatValue(t.getMinutes()),[[i,e,n].join("/"),[o,s].join(":")].join(" ")},t.prototype._formatShortTime=function(t){var n,o,s,e;n=this._format(t,"days"),o=this._format(t,"hours"),s=this._format(t,"minutes"),e=this._format(t,"seconds");var i='<span class="tow-dots">:</span>',r=[o,s,e].map(function(t){var n=t.toString().split("");return n.map(function(t){return'<span class="time-number">'+t+"</span>"}).join("")});return 0==n?r.join(i):[n,"天",r.join(i)].join("")},t.prototype._format=function(t,n){var o;return o=t[n],this._formatValue(o)},t.prototype._formatValue=function(t){return 10>t?"0"+t:t},t}()}).call(this);