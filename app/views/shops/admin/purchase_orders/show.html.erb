<div class='order-detail col-xs-12 col-sm-12 col-md-10 col-md-offset-1 col-lg-10 col-lg-offset-1'>
  <div class='panel panel-default'>
    <div class="panel-body">
      <div class='title'>
        订单信息
        <span class='shop pull-right'>
          <%= link_to shop_site_path(@order.supplier.name) do %>
            <%= image_tag @order.supplier.avatar_url %><%= @order.supplier.title %>
          <% end %>
        </span>
      </div>
      <table class='table table-bordered'>
        <colgroup>
          <col width="50%" />
          <col width="50%" />
        </colgroup>
        <tr class='details'>
          <td>
            <div class='receiver-address'>
              <div class='title'>
                收货人信息
                <div></div>
              </div>
              <div>收货人：<%= @order.receiver_name %></div>
              <div>地&nbsp;&nbsp;&nbsp;&nbsp;址：<%= @order.delivery_address %></div>
              <div>电&nbsp;&nbsp;&nbsp;&nbsp;话：<%= @order.receiver_phone %></div>
            </div>
          </td>
          <td>
            <div class='order-status'>
              <% if @order.initiated? %>
                <div class='title'>订单状态：订单生成成功，等待买家确认！</div>
                <div>订单编号：<%= @order.id %></div>
                <div>您可以
                  <button type="button" class="order-finish btn btn-danger" data-toggle="modal" data-target="#finish-order-<%= @order.id %>">
                    确认收货
                  </button>完成订单
                </div>
              <% elsif @order.finish? %>
                <div class='title'>订单状态：订单已经完成，交易成功！</div>
                <div>订单编号：<%= @order.id %></div>
              <% end %>
        </div>
          </td>
        </tr>
      </table>

      <div class='title'>商品清单</div>
      <div class='items'>
        <table class='table table-bordered order'>
          <colgroup>
            <col width="28%" />
            <col width="24%" />
            <col width="16%" />
            <col width="16%" />
            <col width="16%" />
          </colgroup>

          <tbody>
            <%= render partial: "order_item", collection: @order.items, as: :item, locals: { order: @order, supplier: @order.supplier } %>
            <tr>
              <td colspan='5'>
                <div class='text-right'>
                  一共<%= @order.items_count %>件商品 合计： <%= number_to_currency @order.total %>元
                  <h4>付款：<span class='total'><%= number_to_currency @order.total %>元</span></h4>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<% unless @order.finish? %>
  <div class="modal fade" id="finish-order-<%= @order.id %>" tabindex="-1" role="dialog" aria-labelledby="myOrderLable<%= @order.id %>">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myOrderLable<%= @order.id %>">确认收货</h4>
        </div>
        <div class="modal-body">
          订单号: <%= @order.id %> 确认收货?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
          <%= link_to "确认收货", order_path(@order, "order[status]" => "finish"), method: :patch, class: 'btn btn-primary' %>
          <!-- <button type="button" class="btn btn-primary"></button> -->
        </div>
      </div>
    </div>
  </div>
<% end %>