<div class="edit-category-container">
  <div class="panel panel-default">
    <div class="panel-heading">
      店铺商品编辑
    </div>
    <div class="panel-body">
      <% url = child_shop_admin_shop_category_path(@shop.name, @root.name, @shop_category) %>
      <%= form_for(@shop_category, url: url)do |f| %>
        <div class="form-group">
          <%= f.label :title %>
          <%= f.text_field :title, class: 'form-control', focus: true %>
        </div>
        <div class="form-group">
          <label class="control-label">上传分类图片</label>
          <div class="category-image clearfix">
            <div class="image-preview thumbnail" data-link="<%= url %>">
              <%= image_tag @shop_category.image.url(:cover) %>
            </div>
            <div class="image-upload">
              <div class="upload-btn">上传文件</div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <input type="submit" value="确认" class="btn btn-primary btn-lg">
        </div>
      <% end %>

      <div class="file-uploader-template hidden">
        <div class='qq-uploader'>
          <div class='qq-upload-drop-area' style='display: none;'>
            <span>拖动文件到这里上传</span>
          </div>
          <div class='qq-upload-button'>选择文件上传
          </div>
          <ul class='qq-upload-list' style='display: none;'></ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  var $thumbnail = $('.category-image .thumbnail'),
      url = $thumbnail.data('link'),
      token = $('meta[name="csrf-token"]').attr('content');

  new qq.FileUploader({
    element: $('.image-upload .upload-btn')[0],
    action: url + "/upload_image",
    customHeaders: { "X-CSRF-Token": token },
    multiple: false,
    template: $(".file-uploader-template").html(),
    onComplete: function (id, filename, responseJSON) {
      $thumbnail.find('img').attr('src', responseJSON.url)
    }
  })
</script>
