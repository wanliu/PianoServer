<div class="panel panel-default edit-template" id="new-template">
  <%= form_for(template, url: admins_subject_templates_path(subject), remote: true, html: {"data-type" => 'html'}) do |f| %>
  <div class="panel-heading">
    <h3 class="panel-title">
      <%= f.text_field :filename, class: "form-control template-filename", autofocus: true, placeholder: '请输入文件名称' %>
    </h3>
  </div>

  <div class="panel-body">
    <div id="new-template-content" class="source-editor">
    </div>

    <div class="variables">
      <div class="btn-group-vertical btn-group-justified" role="group" aria-label="variables">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            新增对象
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
          </ul>
        </div>
      </div>
    </div>
    <%= f.hidden_field :content, class: "template_content" %>
  </div>
  <div class="panel-footer">
    <%= f.submit :save, class: 'btn btn-primary' %>
    <%= link_to :Preview, '#',  class: 'btn btn-default' %>
  </div>
  <% end %>
</div>

<script type="text/javascript">
(function() {
  var LiquidMode = ace.require("ace/mode/liquid").Mode;
  var editor = ace.edit("new-template-content");
  editor.getSession().setMode(new LiquidMode());
  editor.setOptions({
    enableBasicAutocompletion: true
  });

  $("#new_template").submit(function(e) {
    $(this).find('.template_content').val(editor.getValue())
  });

  $("#new_template").on("ajax:success", function (e, data, status, xhr) {
    $('#new-template').before(data);

    editor.setValue('');
    editor.resize(true)
    $('#new-template').hide();

    $('#new-template input.template-filename').val('views/undefined.html.liquid');
    $('#new-template input.template_content').val('');
  }).on("ajax:error", function(e, xhr, status, error) { });
})();
</script>
