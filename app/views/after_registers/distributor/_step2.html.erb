<div class="col-md-offset-2 col-md-8">
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=<%= Settings.baidu.ditu.secret %>">
  //v1.5版本的引用方式：src="http://api.map.baidu.com/api?v=1.5&ak=您的密钥"
  //v1.4版本及以前版本的引用方式：src="http://api.map.baidu.com/api?v=1.4&key=您的密钥&callback=initialize"
  </script>

  <div class="page-header">
    <h1>快速开店<small> 商店资料</small></h1>
  </div>
  <%= form_for @shop, url: after_register_path(:distributor, step: :shop), method: :put, layout: :basic do |f| %>
    <div class="panel panel-default" >
      <div class="panel-heading">
        <div class="panel-title ">店铺信息</div>
      </div>
      <div class="panel-body">
        <%= f.text_field :title, label: '商店名'%>
        <%= group_with_errors @shop, :name, f, title: '网址', layout: :normal, input_group: true do %>
            <span class="input-group-addon" id="basic-addon3"><%= Settings.app.website + '/'%></span>
            <%= text_field :shop, :name, class: 'form-control', readonly: true %>
            <span class="input-group-btn">
              <%= button class: 'toggle-edit' do %>
                <b><%= icon :edit %></b>
              <% end %>
            </span>
        <% end %>

        <%= f.text_field :phone %>
        <%= group_with_errors @shop, :description, f, layout: :normal do %>
          <%= f.bootsy_area :description, class: "form-control", rows: 3 %>
        <% end %>

        <%= fields_for :location, @shop.location, layout: :inline do |l| %>
        <div class="form-group">
          <%= f.label :location, "地址" %>
          <div class="city-group row" >
            <div class="col-sm-4">
              <%= select(:location, :province_id, options_for_select(ChinaCity.list), {prompt: '--省份--'}, {class: "city-select form-control"}) %>
            </div>
            <div class="col-sm-4">
              <%= select(:location, :city_id, [], {prompt: "--城市--"}, { class: "city-select form-control" } ) %>
            </div>
            <div class="col-sm-4">
              <%= select(:location, :region_id, [], {prompt: "--地区--"}, { class: "city-select form-control" } ) %>
            </div>
          </div>
        </div>
        <% end %>
        <%= f.text_field :address, label: false %>
        <div id="map">
        </div>
        <script type="text/javascript">
          var map = new BMap.Map("map");          // 创建地图实例
          var point = new BMap.Point(116.404, 39.915);  // 创建点坐标
          map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别
        </script>
        <%= f.hidden_field :owner_id %>
      </div>
    </div>

    <div class="pull-right">
      <%= button "以后再说", after_register_path(:distributor), context: :default, class: 'btn-lg' %>
      <%= button_to "下一步", after_register_path(:distributor), context: :primary, class: 'btn-lg' %>
    </div>
  <% end %>
  <script type="text/javascript">
    $("[name=\"shop[title]\"]").blur(function() {
      var url = "<%= update_shop_path %>";
      $.ajax({
        url: url,
        type: 'PUT',
        data: {
          shop: {
            title: $(this).val()
          }
        }
      }).then(function(resp){
        $("[name=\"shop[name]\"]").val(resp["name"]);
      })
    })

    $(".toggle-edit").click(function (e){
      e.preventDefault();

      var $input = $("[name=\"shop[name]\"]")
      if ($input.attr('readonly')) {
        $input.removeAttr('readonly')
        $input.focus();
        $(this).addClass('active');
      } else {
        $input.attr('readonly', true)
        $(this).removeClass('active');
      }
    });
  </script>

</div>
