<div class='order'>
  <div class='info-head'>
    <% if @order.finish? %>
      <div class='notification pull-left'>
        <h4>订单已经完成</h4>
        <h4>交易成功！</h4>
      </div>
      <div style='clear: both;'></div>
      <%= image_tag 'order-finish.png', class: 'status pull-right' %>
    <% else %>
      <div class='notification pull-left'>
        <h4>订单提交成功</h4>
        <h4>等待买家确认</h4>
      </div>
      <div style='clear: both;'></div>
      <%= image_tag 'order-delivery.png', class: 'status pull-right' %>
    <% end %>
  </div>

  <div class='receiver-info'>
    <div>收 货 人：<%= @order.receiver_name %></div>
    <div>地 &nbsp;&nbsp;&nbsp;&nbsp; 址：<%= @order.delivery_address %></div>
    <div>电 &nbsp;&nbsp;&nbsp;&nbsp; 话：<%= @order.receiver_phone %></div>
  </div>

  <div class='details'>
    <div>订 单 号： <%= @order.id %></div>
    <div>创建时间：<%= @order.created_at.strftime("%Y/%m/%d %H:%M") %></div>
  </div>

  <ul class="list-group order-items">
    <li class="list-group-item order-item">
      <span class='shop'>
        <span class='buyer'> 客户：<%= @order.buyer.username %> </span>
        <span class='pull-right'>订单号: <%= @order.id %></span>
      </span>
    </li>
    <%= render partial: "order_item", collection: @order.items, as: :item, locals: { supplier: @order.supplier } %>
    <li class="list-group-item order-item">
      <div class='text-right'>
        一共<%= @order.items_count %> 件商品&emsp;合计： <%= number_to_currency @order.total %>元
      </div>
    </li>
  </ul>

  <% unless @order.finish? %>
    <nav class="navbar navbar-default navbar-fixed-bottom">
      <div class="container">
        <div class='operation pull-right'>
          <span class="now-you-can">您现在可以</span>
          <button type="button" class="btn btn-danger"  data-toggle="modal" data-target="#change-total-<%= @order.id %>">
            修改总价
          </button>
        </div>
      </div>
    </nav>

    <div class="modal fade" id="change-total-<%= @order.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <%= form_for @order, url: shop_admin_order_path(@order.supplier.name, @order) do |f| %>
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">修改第<%= @order.id %>号订单总价</h4>
            </div>
            <div class="modal-body">
              <div>
                原价：<span class='order-total'><%= number_to_currency @order.total %></span>
              </div>
              <div class="form-inline">
                <div class="form-group">
                  <label for="new-order-total-<%= @order.id %>">修改为：</label>
                  <%= f.number_field :total, class: "form-control", id: "new-order-total-#{ @order.id }", placeholder: "输入新的订单总价", autocomplete: "off", step: 0.1 %>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
              <%= f.submit "确定修改", class: "btn btn-primary confirm-order-change" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>